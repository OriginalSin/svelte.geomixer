var app=function(){"use strict";function e(){}function t(e,t){for(var n in t)e[n]=t[n];return e}function n(e,t){for(var n in t)e[n]=1;return e}function r(e){e()}function i(e,t){e.appendChild(t)}function s(e,t,n){e.insertBefore(t,n)}function a(e){e.parentNode.removeChild(e)}function o(e,t){for(var n=0;n<e.length;n+=1)e[n]&&e[n].d(t)}function l(e){return document.createElement(e)}function c(e){return document.createTextNode(e)}function d(e,t,n){e.addEventListener(t,n,!1)}function p(e,t,n){e.removeEventListener(t,n,!1)}function u(e,t,n){e.setAttribute(t,n)}function h(e,t){e.data=""+t}function m(){return Object.create(null)}function f(e){e._lock=!0,g(e._beforecreate),g(e._oncreate),g(e._aftercreate),e._lock=!1}function v(e,t){e._handlers=m(),e._slots=m(),e._bind=t._bind,e._staged={},e.options=t,e.root=t.root||e,e.store=t.store||e.root.store,t.root||(e._beforecreate=[],e._oncreate=[],e._aftercreate=[])}function g(e){for(;e&&e.length;)e.shift()()}var _={destroy:function(t){this.destroy=e,this.fire("destroy"),this.set=e,this._fragment.d(!1!==t),this._fragment=null,this._state={}},get:function(){return this._state},fire:function(e,t){var n=e in this._handlers&&this._handlers[e].slice();if(n)for(var r=0;r<n.length;r+=1){var i=n[r];if(!i.__calling)try{i.__calling=!0,i.call(this,t)}finally{i.__calling=!1}}},on:function(e,t){var n=this._handlers[e]||(this._handlers[e]=[]);return n.push(t),{cancel:function(){var e=n.indexOf(t);~e&&n.splice(e,1)}}},set:function(e){this._set(t({},e)),this.root._lock||f(this.root)},_recompute:e,_set:function(e){var n=this._state,r={},i=!1;for(var s in e=t(this._staged,e),this._staged={},e)this._differs(e[s],n[s])&&(r[s]=i=!0);i&&(this._state=t(t({},n),e),this._recompute(r,this._state),this._bind&&this._bind(r,this._state),this._fragment&&(this.fire("state",{changed:r,current:this._state,previous:n}),this._fragment.p(r,this._state),this.fire("update",{changed:r,current:this._state,previous:n})))},_stage:function(e){t(this._staged,e)},_mount:function(e,t){this._fragment[this._fragment.i?"i":"m"](e,t||null)},_differs:function(e,t){return e!=e?t==t:e!==t||e&&"object"==typeof e||"function"==typeof e}};var y={createMap(e){},mouseOverOut(e,t){let n=e.target.getElementsByClassName("cont-center")[0];console.log("mouseover",n),this.prevNode&&(this.prevNode.style.visibility="hidden"),n&&(this.prevNode=n,n.style.visibility=t?"visible":"hidden")}};function k({changed:e,current:t,previous:n}){e.group&&t.group}function w(e,t){var n;return{c(){(n=l("span")).innerHTML='<svg role="img" class="svgIcon svelte-rp6a0"><use xlink:href="#overlays" href="#overlays"></use></svg>',n.className="cont-overlays svelte-rp6a0"},m(e,t){s(e,n,t)},d(e){e&&a(n)}}}function N(e,t){var n;return{c(){(n=l("span")).innerHTML='<svg role="img" class="svgIcon svelte-rp6a0"><use xlink:href="#info-circle-i" href="#info-circle-i"></use></svg>',n.className="cont-info",n.title="View description"},m(e,t){s(e,n,t)},d(e){e&&a(n)}}}function b(e,t){var n,r,o,d,p=t.properties.styles.length>1&&w(),u=t.properties.description&&N();return{c(){p&&p.c(),n=c("\r\n\t\t\t\t"),r=l("span"),(o=l("span")).innerHTML='<svg role="img" class="svgIcon svelte-rp6a0"><use xlink:href="#center-on-click" href="#center-on-click"></use></svg>',d=c("\r\n\t\t\t\t\t"),u&&u.c(),o.className="cont-center hidden svelte-rp6a0",o.title="Move map to this layer",r.className="icons  svelte-rp6a0"},m(e,t){p&&p.m(e,t),s(e,n,t),s(e,r,t),i(r,o),i(r,d),u&&u.m(r,null)},p(e,t){t.properties.styles.length>1?p||((p=w()).c(),p.m(n.parentNode,n)):p&&(p.d(1),p=null),t.properties.description?u||((u=N()).c(),u.m(r,null)):u&&(u.d(1),u=null)},d(e){p&&p.d(e),e&&(a(n),a(r)),u&&u.d()}}}function M(e,t){var n,r,i,o,d,p,h,m,f="layer"===t.line.type&&b(0,t);return{c(){n=l("div"),r=c("\r\n\t\t\t"),i=l("input"),d=c("\r\n\t\t\t"),(p=l("span")).innerHTML='<svg role="img" class="svgIcon svelte-rp6a0"><use xlink:href="#arrow-small-down" href="#arrow-small-down"></use></svg>',h=c("\r\n\t\t\t"),f&&f.c(),m=document.createComment(""),n.className="borders ",i.className="expander hidden",u(i,"type","checkbox"),i.checked=o=!!t.properties.expanded,p.className="expander expanderCont svelte-rp6a0"},m(e,t){s(e,n,t),s(e,r,t),s(e,i,t),s(e,d,t),s(e,p,t),s(e,h,t),f&&f.m(e,t),s(e,m,t)},p(e,t){e.properties&&o!==(o=!!t.properties.expanded)&&(i.checked=o),"layer"===t.line.type?f?f.p(e,t):((f=b(0,t)).c(),f.m(m.parentNode,m)):f&&(f.d(1),f=null)},d(e){e&&(a(n),a(r),a(i),a(d),a(p),a(h)),f&&f.d(e),e&&a(m)}}}function T(e,t){var n,r,i;return{c(){n=l("input"),r=c("\r\n\t\t\t\t"),(i=l("span")).innerHTML='<span class="legendIconCell style"><span class="legendIconStyle point" style="background-color: rgba(255, 255, 255, 0.2); border-color: rgb(0, 0, 255);"></span></span>',n.className="check visibility ",u(n,"type","checkbox"),i.className="styleIcon gmx-style-legend"},m(e,t){s(e,n,t),s(e,r,t),s(e,i,t)},d(e){e&&(a(n),a(r),a(i))}}}function x(e,t){var n,r,o,d,p,u,m,f,v,g=t.properties.title,_="map"!==t.line.type&&M(0,t),y="map"!==t.line.type&&T();return{c(){_&&_.c(),n=c("\r\n\t\t"),r=l("span"),y&&y.c(),o=c("\r\n\t\t\t"),d=l("label"),p=c(g),u=c("\r\n\t\t\t"),m=l("div"),f=c("\r\n\t\t\t"),v=l("div"),d.className="title",m.className="description collapse",v.className="legend collapse",r.className="cont"},m(e,t){_&&_.m(e,t),s(e,n,t),s(e,r,t),y&&y.m(r,null),i(r,o),i(r,d),i(d,p),i(r,u),i(r,m),i(r,f),i(r,v)},p(e,t){"map"!==t.line.type?_?_.p(e,t):((_=M(0,t)).c(),_.m(n.parentNode,n)):_&&(_.d(1),_=null),"map"!==t.line.type?y||((y=T()).c(),y.m(r,o)):y&&(y.d(1),y=null),e.properties&&g!==(g=t.properties.title)&&h(p,g)},d(e){_&&_.d(e),e&&(a(n),a(r)),y&&y.d()}}}function C(e,t){var n,r={line:t.child},i=new H({root:e.root,store:e.store,data:r});return{c(){i._fragment.c()},m(e,t){i._mount(e,t),n=!0},p(e,t){var n={};e.line&&(n.line=t.child),i._set(n)},i(e,t){n||this.m(e,t)},o(e){n&&(i&&i._fragment.o(e),n=!1)},d(e){i.destroy(e)}}}function S(e,t){for(var n,r,i,c=t.line.content.children||[],d=[],p=0;p<c.length;p+=1)d[p]=C(e,E(t,c,p));function u(e,t,n){d[e]&&d[e].o(()=>{t&&(d[e].d(t),d[e]=null),n&&n()})}return{c(){n=l("ul");for(var e=0;e<d.length;e+=1)d[e].c();n.className=r="group css-treeview id_"+(t.properties?t.properties.name:"root")+" svelte-rp6a0"},m(e,t){s(e,n,t);for(var r=0;r<d.length;r+=1)d[r].i(n,null);i=!0},p(t,s){if(t.line){c=s.line.content.children||[];for(var a=0;a<c.length;a+=1){const r=E(s,c,a);d[a]?d[a].p(t,r):(d[a]=C(e,r),d[a].c()),d[a].i(n,null)}for(;a<d.length;a+=1)u(a,1)}i&&!t.properties||r===(r="group css-treeview id_"+(s.properties?s.properties.name:"root")+" svelte-rp6a0")||(n.className=r)},i(e,t){i||this.m(e,t)},o(e){if(!i)return;d=d.filter(Boolean);const t=(n=e,0===(r=d.length)&&n(),()=>{--r||n()});var n,r;for(let e=0;e<d.length;e+=1)u(e,0,t);i=!1},d(e){e&&a(n),o(d,e)}}}function E(e,t,n){const r=Object.create(e);return r.child=t[n],r.each_value=t,r.child_index=n,r}function H(e){v(this,e),this._state=t({container:null,line:null},e.data),this._recompute({line:1},this._state),this._intro=!!e.intro,this._handlers.state=[k],k.call(this,{changed:n({},this._state),current:this._state}),this._fragment=function(e,t){var n,r,o,u,h=t.properties&&x(0,t),m=t.line.content.children&&S(e,t);function f(t){e.mouseOverOut(t,!0)}return{c(){n=l("li"),h&&h.c(),r=c("\r\n\t"),m&&m.c(),d(n,"mouseover",f),n.className=o="line id_"+(t.properties?t.properties.name:"root")+" svelte-rp6a0"},m(e,t){s(e,n,t),h&&h.m(n,null),i(n,r),m&&m.m(n,null),u=!0},p(t,i){i.properties?h?h.p(t,i):((h=x(0,i)).c(),h.m(n,r)):h&&(h.d(1),h=null),i.line.content.children?(m?m.p(t,i):(m=S(e,i))&&m.c(),m.i(n,null)):m&&m.o(function(){m.d(1),m=null}),u&&!t.properties||o===(o="line id_"+(i.properties?i.properties.name:"root")+" svelte-rp6a0")||(n.className=o)},i(e,t){u||this.m(e,t)},o(e){u&&(m?m.o(e):e(),u=!1)},d(e){e&&a(n),h&&h.d(),m&&m.d(),p(n,"mouseover",f)}}}(this,this._state),this.root._oncreate.push(()=>{this.fire("update",{changed:n({},this._state),current:this._state})}),e.target&&(this._fragment.c(),this._mount(e.target,e.anchor),f(this)),this._intro=!0}t(H.prototype,_),t(H.prototype,y),H.prototype._recompute=function(e,t){e.line&&(this._differs(t.properties,t.properties=function({line:e}){return e.content.properties}(t))&&(e.properties=!0),this._differs(t.minutes,t.minutes=function({line:e}){return(new Date).getMinutes()}(t))&&(e.minutes=!0),this._differs(t.seconds,t.seconds=function({line:e}){return(new Date).getSeconds()}(t))&&(e.seconds=!0))};var I={createMap(e){},_initTree(e){console.log("_initTree",e)}};function O({changed:e,current:t,previous:n}){console.log("TreeView in onstate",e,t,n),e.rawTree&&t.rawTree&&console.log("kjkkkkkkkkkkk in onstate",e,t,n)}function P(e){var r,i,o,c,d,p;v(this,e),this._state=t({group:null,container:null,rawTree:null},e.data),this._intro=!!e.intro,this._handlers.state=[O],O.call(this,{changed:n({},this._state),current:this._state}),this._fragment=(r=this,i=this._state,d={line:i.rawTree},p=new H({root:r.root,store:r.store,data:d}),{c(){o=l("div"),p._fragment.c(),o.className="TreeView"},m(e,t){s(e,o,t),p._mount(o,null),c=!0},p(e,t){var n={};e.rawTree&&(n.line=t.rawTree),p._set(n)},i(e,t){c||this.m(e,t)},o(e){c&&(p&&p._fragment.o(e),c=!1)},d(e){e&&a(o),p.destroy()}}),this.root._oncreate.push(()=>{this.fire("update",{changed:n({},this._state),current:this._state})}),e.target&&(this._fragment.c(),this._mount(e.target,e.anchor),f(this)),this._intro=!0}t(P.prototype,_),t(P.prototype,I);window.serverBase;var D={createMap(e){let t=(e.app||{}).gmxMap||{},n=e.state||{},r=t.mapID||"946GH",i=(t.apiKey,n.map?n.map.position:{});var s=L.tileLayer("//tilessputnik.ru/{z}/{x}/{y}.png",{maxZoom:18});let a=new L.Map("map",{layers:[s],center:new L.LatLng(i.y||0,i.x||60),zoom:i.z||3});var o=L.control.iconSidebar({width111:360});a.addControl(o);var l=L.DomUtil.create("div","treeViewCont"),c=L.DomUtil.create("div","tabIcon",l);L.DomUtil.create("div","tabCont",l);c.innerHTML='<svg role="img" class="svgIcon"><use xlink:href="#overlays" href="#overlays"></use></svg>';var d=o.setPane("treeView",{createTab:function(e){return"active"===e?L.DomUtil.addClass(l,"icon_active"):L.DomUtil.removeClass(l,"icon_active"),l}});a.gmxControlsManager.init(),L.gmx.loadMap(r,{leafletMap:a}).then(function(e){o.on("opened",function(t){"treeView"===t.id&&this._initTree({container:d,rawTree:e.rawTree})},this)}.bind(this)),this.set({map:a})},_initTree(e){new P({target:e.container,data:{container:e.container,rawTree:{type:"map",content:e.rawTree}}}).on("foo",({changed:e,current:t,previous:n})=>{console.log("sdddddddddddtate changed",t)}),console.log("_initTree",e)}};function W({changed:e,current:t,previous:n}){e.permalink&&t.permalink&&this.createMap(t.permalink)}function j(i){var o,c;v(this,i),this._state=t({permalink:null,map:null},i.data),this._intro=!!i.intro,this._handlers.state=[W],W.call(this,{changed:n({},this._state),current:this._state}),this._fragment=(this._state,{c(){(o=l("div")).id="map"},m(e,t){s(e,o,t),c=!0},p:e,i(e,t){c||this.m(e,t)},o:r,d(e){e&&a(o)}}),this.root._oncreate.push(()=>{this.fire("update",{changed:n({},this._state),current:this._state})}),i.target&&(this._fragment.c(),this._mount(i.target,i.anchor),f(this)),this._intro=!0}t(j.prototype,_),t(j.prototype,D);const B=window.serverBase||"//maps.kosmosnimki.ru/";var V={checkMe(e){},editTrigger(e,t){let n=e.parentNode,r=n.parentNode.lastChild;t?(r.previousElementSibling.classList.remove("hidden"),r.classList.add("hidden")):(r.previousElementSibling.classList.add("hidden"),r.classList.remove("hidden")),n.firstChild.classList.remove("checked"),n.lastChild.classList.remove("checked"),e.classList.add("checked")},getPermalink(e){return fetch(B+"TinyReference/Get.ashx?WrapStyle=None&id="+e,{mode:"cors",credentials:"include"}).then(e=>e.json()).then(e=>{if("ok"===e.Status){let t=e.Result?JSON.parse(e.Result):{};this.set({permalink:t,confStr:JSON.stringify(t,null,2)})}})}};function U({changed:e,current:t,previous:n}){e.urlParams&&this.getPermalink(t.urlParams.config)}function z({changed:e,current:t,previous:n}){if(e.confStr){let e=document.getElementsByClassName("view")[0];e.innerHTML=t.confStr,hljs.highlightBlock(e)}}function R(e,t){var n,r,o,u,m,f,v,g=t.it.title;return{c(){n=l("div"),r=l("i"),u=c("\r\n\t\t\t\t\t"),m=l("span"),f=c(g),r.className=o="icon-"+t.it.name+" svelte-foruym",n._svelte={component:e,ctx:t},d(n,"click",J),n.className=v="dropdownMenuWidget-item"+(t.it.checked?" checked":"")+" svelte-foruym"},m(e,t){s(e,n,t),i(n,r),i(n,u),i(n,m),i(m,f)},p(e,t){e.dropdownMenu&&o!==(o="icon-"+t.it.name+" svelte-foruym")&&(r.className=o),e.dropdownMenu&&g!==(g=t.it.title)&&h(f,g),n._svelte.ctx=t,e.dropdownMenu&&v!==(v="dropdownMenuWidget-item"+(t.it.checked?" checked":"")+" svelte-foruym")&&(n.className=v)},d(e){e&&a(n),p(n,"click",J)}}}function G(e,t,n){const r=Object.create(e);return r.it=t[n],r.each_value=t,r.it_index=n,r}function J(e){const{component:t,ctx:n}=this._svelte;t.checkMe(n.it)}function A(e){v(this,e),this._state=t({urlParams:{},dropdownMenu:[{name:"refresh",title:"Refresh"},{name:"link",title:"Share"},{name:"magic",title:"Wizard"}],map:null,permalink:null,confStr:""},e.data),this._intro=!!e.intro,this._handlers.state=[U],this._handlers.update=[z],U.call(this,{changed:n({},this._state),current:this._state}),this._fragment=function(e,t){for(var n,r,u,m,f,v,g,_,y,k,w,N,b,M,T,x,L,C,S,E={},H=t.dropdownMenu,I=[],O=0;O<H.length;O+=1)I[O]=R(e,G(t,H,O));function P(t){e.editTrigger(this,!0)}function D(t){e.editTrigger(this)}var W={permalink:t.permalink};void 0!==t.map&&(W.map=t.map,E.map=!0);var B=new j({root:e.root,store:e.store,data:W,_bind(t,n){var r={};!E.map&&t.map&&(r.map=n.map),e._set(r),E={}}});return e.root._beforecreate.push(()=>{B._bind({map:1},B.get())}),{c(){n=l("div"),r=l("div"),u=l("div"),m=l("div");for(var e=0;e<I.length;e+=1)I[e].c();f=c("\r\n\t\t"),v=l("div"),g=l("div"),_=l("ul"),(y=l("li")).innerHTML='<i class="icon-bell"></i>\r\n\t\t\t\t\t\t<span>Edit</span>',k=c("\r\n\t\t\t\t\t"),(w=l("li")).innerHTML='<i class="icon-eye"></i>\r\n\t\t\t\t\t\t<span>View</span>',N=c("\r\n\t\t\t\t"),b=l("textarea"),M=c("\r\n\t\t\t\t"),T=l("div"),x=c(t.confStr),L=c("\r\n"),C=l("div"),B._fragment.c(),m.className="dropdownMenuWidget svelte-foruym",u.className="sidebarPanel-toolbarContainer svelte-foruym",d(y,"click",P),y.className="dropdownMenuWidget-item svelte-foruym",d(w,"click",D),w.className="dropdownMenuWidget-item checked svelte-foruym",_.className="dropdownMenuWidget right svelte-foruym",b.className="text-input hidden svelte-foruym",b.value=t.confStr,T.className="view svelte-foruym",g.className="editor svelte-foruym",v.className="sidebarPanel-codeEditorContainer svelte-foruym",r.className="sidebarPanel svelte-foruym",n.className="editor-sidebarContainer editor_sidebarExpanded svelte-foruym",C.className="editor-viewerContainer editor_sidebarExpanded"},m(e,t){s(e,n,t),i(n,r),i(r,u),i(u,m);for(var a=0;a<I.length;a+=1)I[a].m(m,null);i(r,f),i(r,v),i(v,g),i(g,_),i(_,y),i(_,k),i(_,w),i(g,N),i(g,b),i(g,M),i(g,T),i(T,x),s(e,L,t),s(e,C,t),B._mount(C,null),S=!0},p(n,r){if(t=r,n.dropdownMenu){H=t.dropdownMenu;for(var i=0;i<H.length;i+=1){const r=G(t,H,i);I[i]?I[i].p(n,r):(I[i]=R(e,r),I[i].c(),I[i].m(m,null))}for(;i<I.length;i+=1)I[i].d(1);I.length=H.length}S&&!n.confStr||(b.value=t.confStr,h(x,t.confStr));var s={};n.permalink&&(s.permalink=t.permalink),!E.map&&n.map&&(s.map=t.map,E.map=void 0!==t.map),B._set(s),E={}},i(e,t){S||this.m(e,t)},o(e){S&&(B&&B._fragment.o(e),S=!1)},d(e){e&&a(n),o(I,e),p(y,"click",P),p(w,"click",D),e&&(a(L),a(C)),B.destroy()}}}(this,this._state),this.root._oncreate.push(()=>{(function(){}).call(this),this.fire("update",{changed:n({},this._state),current:this._state})}),e.target&&(this._fragment.c(),this._mount(e.target,e.anchor),f(this)),this._intro=!0}t(A.prototype,_),t(A.prototype,V);let K=(()=>{let e={};return location.search.substr(1).split("&").forEach(t=>{let n=t.split("=");e[n[0]]=n[1]}),e})();return new A({target:document.body,data:{urlParams:K,name:"world"}})}();
//# sourceMappingURL=bundle.js.map
