var app=function(){"use strict";function t(){}function e(t,e){for(var n in e)t[n]=e[n];return t}function n(t,e){for(var n in e)t[n]=1;return t}function r(t){t()}function i(t,e){t.appendChild(e)}function o(t,e,n){t.insertBefore(e,n)}function a(t){t.parentNode.removeChild(t)}function s(t,e){for(var n=0;n<t.length;n+=1)t[n]&&t[n].d(e)}function c(t){return document.createElement(t)}function l(t){return document.createTextNode(t)}function h(t,e,n){t.addEventListener(e,n,!1)}function u(t,e,n){t.removeEventListener(e,n,!1)}function d(t,e){t.data=""+e}function p(){return Object.create(null)}function m(t){t._lock=!0,_(t._beforecreate),_(t._oncreate),_(t._aftercreate),t._lock=!1}function f(t,e){t._handlers=p(),t._slots=p(),t._bind=e._bind,t._staged={},t.options=e,t.root=e.root||t,t.store=e.store||t.root.store,e.root||(t._beforecreate=[],t._oncreate=[],t._aftercreate=[])}function _(t){for(;t&&t.length;)t.shift()()}var g={destroy:function(e){this.destroy=t,this.fire("destroy"),this.set=t,this._fragment.d(!1!==e),this._fragment=null,this._state={}},get:function(){return this._state},fire:function(t,e){var n=t in this._handlers&&this._handlers[t].slice();if(n)for(var r=0;r<n.length;r+=1){var i=n[r];if(!i.__calling)try{i.__calling=!0,i.call(this,e)}finally{i.__calling=!1}}},on:function(t,e){var n=this._handlers[t]||(this._handlers[t]=[]);return n.push(e),{cancel:function(){var t=n.indexOf(e);~t&&n.splice(t,1)}}},set:function(t){this._set(e({},t)),this.root._lock||m(this.root)},_recompute:t,_set:function(t){var n=this._state,r={},i=!1;for(var o in t=e(this._staged,t),this._staged={},t)this._differs(t[o],n[o])&&(r[o]=i=!0);i&&(this._state=e(e({},n),t),this._recompute(r,this._state),this._bind&&this._bind(r,this._state),this._fragment&&(this.fire("state",{changed:r,current:this._state,previous:n}),this._fragment.p(r,this._state),this.fire("update",{changed:r,current:this._state,previous:n})))},_stage:function(t){e(this._staged,t)},_mount:function(t,e){this._fragment[this._fragment.i?"i":"m"](t,e||null)},_differs:function(t,e){return t!=t?e==e:t!==e||t&&"object"==typeof t||"function"==typeof t}};var v={createMap(t){},_initTree(t){console.log("_initTree",t)}};function y({changed:t,current:e,previous:n}){t.group&&e.group}function w(t){var s,h,u,p,_,g;f(this,t),this._state=e({container:null,line:null},t.data),this._intro=!!t.intro,this._handlers.state=[y],y.call(this,{changed:n({},this._state),current:this._state}),this._fragment=(s=this._state,g=s.line.content.properties.title,{c(){h=c("li"),u=l(g),h.className=p="line id_"+s.line.content.properties.name},m(t,e){o(t,h,e),i(h,u),_=!0},p(t,e){t.line&&g!==(g=e.line.content.properties.title)&&d(u,g),t.line&&p!==(p="line id_"+e.line.content.properties.name)&&(h.className=p)},i(t,e){_||this.m(t,e)},o:r,d(t){t&&a(h)}}),this.root._oncreate.push(()=>{this.fire("update",{changed:n({},this._state),current:this._state})}),t.target&&(this._fragment.c(),this._mount(t.target,t.anchor),m(this)),this._intro=!0}e(w.prototype,g),e(w.prototype,v);var k={createMap(t){},_initTree(t){console.log("_initTree",t)}};function T({changed:t,current:e,previous:n}){t.group&&e.group}function b(t,e){var n,r,i,s,c=[N,M],l=[];function h(t){return"layer"===t.line.type?0:1}return n=h(e),r=l[n]=c[n](t,e),{c(){r.c(),i=document.createComment("")},m(t,e){l[n].m(t,e),o(t,i,e),s=!0},p(e,o){var a=n;(n=h(o))===a?l[n].p(e,o):(r.o(function(){l[a].d(1),l[a]=null}),(r=l[n])||(r=l[n]=c[n](t,o)).c(),r.m(i.parentNode,i))},i(t,e){s||this.m(t,e)},o(t){s&&(r?r.o(t):t(),s=!1)},d(t){l[n].d(t),t&&a(i)}}}function N(t,e){var n,r={line:e.line},i=new w({root:t.root,store:t.store,data:r});return{c(){i._fragment.c()},m(t,e){i._mount(t,e),n=!0},p(t,e){var n={};t.group&&(n.line=e.line),i._set(n)},i(t,e){n||this.m(t,e)},o(t){n&&(i&&i._fragment.o(t),n=!1)},d(t){i.destroy(t)}}}function M(t,e){var n,r={group:e.line},i=new C({root:t.root,store:t.store,data:r});return{c(){i._fragment.c()},m(t,e){i._mount(t,e),n=!0},p(t,e){var n={};t.group&&(n.group=e.line),i._set(n)},i(t,e){n||this.m(t,e)},o(t){n&&(i&&i._fragment.o(t),n=!1)},d(t){i.destroy(t)}}}function x(t,e,n){const r=Object.create(t);return r.line=e[n],r.each_value=e,r.line_index=n,r}function C(t){f(this,t),this._state=e({container:null,group:null},t.data),this._intro=!!t.intro,this._handlers.state=[T],T.call(this,{changed:n({},this._state),current:this._state}),this._fragment=function(t,e){for(var n,r,h,u,p,m=e.group.content.properties?e.group.content.properties.title:"",f=e.group.content.children||[],_=[],g=0;g<f.length;g+=1)_[g]=b(t,x(e,f,g));function v(t,e,n){_[t]&&_[t].o(()=>{e&&(_[t].d(e),_[t]=null),n&&n()})}return{c(){n=c("ul"),r=l(m),h=l("\r\n\t\r\n");for(var t=0;t<_.length;t+=1)_[t].c();n.className=u="group id_"+(e.group.content.properties?e.group.content.properties.name:"root")},m(t,e){o(t,n,e),i(n,r),i(n,h);for(var a=0;a<_.length;a+=1)_[a].i(n,null);p=!0},p(e,i){if(p&&!e.group||m===(m=i.group.content.properties?i.group.content.properties.title:"")||d(r,m),e.group){f=i.group.content.children||[];for(var o=0;o<f.length;o+=1){const r=x(i,f,o);_[o]?_[o].p(e,r):(_[o]=b(t,r),_[o].c()),_[o].i(n,null)}for(;o<_.length;o+=1)v(o,1)}p&&!e.group||u===(u="group id_"+(i.group.content.properties?i.group.content.properties.name:"root"))||(n.className=u)},i(t,e){p||this.m(t,e)},o(t){if(!p)return;_=_.filter(Boolean);const e=(n=t,0===(r=_.length)&&n(),()=>{--r||n()});var n,r;for(let t=0;t<_.length;t+=1)v(t,0,e);p=!1},d(t){t&&a(n),s(_,t)}}}(this,this._state),this.root._oncreate.push(()=>{this.fire("update",{changed:n({},this._state),current:this._state})}),t.target&&(this._fragment.c(),this._mount(t.target,t.anchor),m(this)),this._intro=!0}e(C.prototype,g),e(C.prototype,k);var S={createMap(t){},_initTree(t){console.log("_initTree",t)}};function E({changed:t,current:e,previous:n}){console.log("TreeView in onstate",t,e,n),t.rawTree&&e.rawTree}function P(t){var r,i,s,l,h,u;f(this,t),this._state=e({group:null,container:null,rawTree:null},t.data),this._intro=!!t.intro,this._handlers.state=[E],E.call(this,{changed:n({},this._state),current:this._state}),this._fragment=(r=this,i=this._state,h={group:i.rawTree},u=new C({root:r.root,store:r.store,data:h}),{c(){s=c("div"),u._fragment.c(),s.className="TreeView"},m(t,e){o(t,s,e),u._mount(s,null),l=!0},p(t,e){var n={};t.rawTree&&(n.group=e.rawTree),u._set(n)},i(t,e){l||this.m(t,e)},o(t){l&&(u&&u._fragment.o(t),l=!1)},d(t){t&&a(s),u.destroy()}}),this.root._oncreate.push(()=>{this.fire("update",{changed:n({},this._state),current:this._state})}),t.target&&(this._fragment.c(),this._mount(t.target,t.anchor),m(this)),this._intro=!0}e(P.prototype,g),e(P.prototype,S);window.serverBase;var W={createMap(t){let e=(t.app||{}).gmxMap||{},n=t.state||{},r=e.mapID||"946GH",i=(e.apiKey,n.map?n.map.position:{});var o=L.tileLayer("//tilessputnik.ru/{z}/{x}/{y}.png",{maxZoom:18});let a=new L.Map("map",{layers:[o],center:new L.LatLng(i.y||0,i.x||60),zoom:i.z||3});var s=L.control.iconSidebar({width111:360});a.addControl(s);var c=L.DomUtil.create("div","treeViewCont"),l=L.DomUtil.create("div","tabIcon",c);L.DomUtil.create("div","tabCont",c);l.innerHTML='<svg role="img" class="svgIcon"><use xlink:href="#overlays" href="#overlays"></use></svg>';var h=s.setPane("treeView",{createTab:function(t){return"active"===t?L.DomUtil.addClass(c,"icon_active"):L.DomUtil.removeClass(c,"icon_active"),c}});a.gmxControlsManager.init(),L.gmx.loadMap(r,{leafletMap:a}).then(function(t){s.on("opened",function(e){"treeView"===e.id&&this._initTree({container:h,rawTree:t.rawTree})},this)}.bind(this)),this.set({map:a})},_initTree(t){new P({target:t.container,data:{container:t.container,rawTree:{type:"group",content:{children:t.rawTree.children}}}});console.log("_initTree",t)}};function j({changed:t,current:e,previous:n}){t.permalink&&e.permalink&&this.createMap(e.permalink)}function B(i){var s,l;f(this,i),this._state=e({permalink:null,map:null},i.data),this._intro=!!i.intro,this._handlers.state=[j],j.call(this,{changed:n({},this._state),current:this._state}),this._fragment=(this._state,{c(){(s=c("div")).id="map"},m(t,e){o(t,s,e),l=!0},p:t,i(t,e){l||this.m(t,e)},o:r,d(t){t&&a(s)}}),this.root._oncreate.push(()=>{this.fire("update",{changed:n({},this._state),current:this._state})}),i.target&&(this._fragment.c(),this._mount(i.target,i.anchor),m(this)),this._intro=!0}e(B.prototype,g),e(B.prototype,W);const D=window.serverBase||"//maps.kosmosnimki.ru/";var O={checkMe(t){},editTrigger(t,e){let n=t.parentNode,r=n.parentNode.lastChild;e?(r.previousElementSibling.classList.remove("hidden"),r.classList.add("hidden")):(r.previousElementSibling.classList.add("hidden"),r.classList.remove("hidden")),n.firstChild.classList.remove("checked"),n.lastChild.classList.remove("checked"),t.classList.add("checked")},getPermalink(t){return fetch(D+"TinyReference/Get.ashx?WrapStyle=None&id="+t,{mode:"cors",credentials:"include"}).then(t=>t.json()).then(t=>{if("ok"===t.Status){let e=t.Result?JSON.parse(t.Result):{};this.set({permalink:e,confStr:JSON.stringify(e,null,2)})}})}};function V({changed:t,current:e,previous:n}){t.urlParams&&this.getPermalink(e.urlParams.config)}function H({changed:t,current:e,previous:n}){if(t.confStr){let t=document.getElementsByClassName("view")[0];t.innerHTML=e.confStr,hljs.highlightBlock(t)}}function U(t,e){var n,r,s,p,m,f,_,g=e.it.title;return{c(){n=c("div"),r=c("i"),p=l("\r\n\t\t\t\t\t"),m=c("span"),f=l(g),r.className=s="icon-"+e.it.name+" svelte-foruym",n._svelte={component:t,ctx:e},h(n,"click",R),n.className=_="dropdownMenuWidget-item"+(e.it.checked?" checked":"")+" svelte-foruym"},m(t,e){o(t,n,e),i(n,r),i(n,p),i(n,m),i(m,f)},p(t,e){t.dropdownMenu&&s!==(s="icon-"+e.it.name+" svelte-foruym")&&(r.className=s),t.dropdownMenu&&g!==(g=e.it.title)&&d(f,g),n._svelte.ctx=e,t.dropdownMenu&&_!==(_="dropdownMenuWidget-item"+(e.it.checked?" checked":"")+" svelte-foruym")&&(n.className=_)},d(t){t&&a(n),u(n,"click",R)}}}function z(t,e,n){const r=Object.create(t);return r.it=e[n],r.each_value=e,r.it_index=n,r}function R(t){const{component:e,ctx:n}=this._svelte;e.checkMe(n.it)}function I(t){f(this,t),this._state=e({urlParams:{},dropdownMenu:[{name:"refresh",title:"Refresh"},{name:"link",title:"Share"},{name:"magic",title:"Wizard"}],map:null,permalink:null,confStr:""},t.data),this._intro=!!t.intro,this._handlers.state=[V],this._handlers.update=[H],V.call(this,{changed:n({},this._state),current:this._state}),this._fragment=function(t,e){for(var n,r,p,m,f,_,g,v,y,w,k,T,b,N,M,L,x,C,S,E={},P=e.dropdownMenu,W=[],j=0;j<P.length;j+=1)W[j]=U(t,z(e,P,j));function D(e){t.editTrigger(this,!0)}function O(e){t.editTrigger(this)}var V={permalink:e.permalink};void 0!==e.map&&(V.map=e.map,E.map=!0);var H=new B({root:t.root,store:t.store,data:V,_bind(e,n){var r={};!E.map&&e.map&&(r.map=n.map),t._set(r),E={}}});return t.root._beforecreate.push(()=>{H._bind({map:1},H.get())}),{c(){n=c("div"),r=c("div"),p=c("div"),m=c("div");for(var t=0;t<W.length;t+=1)W[t].c();f=l("\r\n\t\t"),_=c("div"),g=c("div"),v=c("ul"),(y=c("li")).innerHTML='<i class="icon-bell"></i>\r\n\t\t\t\t\t\t<span>Edit</span>',w=l("\r\n\t\t\t\t\t"),(k=c("li")).innerHTML='<i class="icon-eye"></i>\r\n\t\t\t\t\t\t<span>View</span>',T=l("\r\n\t\t\t\t"),b=c("textarea"),N=l("\r\n\t\t\t\t"),M=c("div"),L=l(e.confStr),x=l("\r\n"),C=c("div"),H._fragment.c(),m.className="dropdownMenuWidget svelte-foruym",p.className="sidebarPanel-toolbarContainer svelte-foruym",h(y,"click",D),y.className="dropdownMenuWidget-item svelte-foruym",h(k,"click",O),k.className="dropdownMenuWidget-item checked svelte-foruym",v.className="dropdownMenuWidget right svelte-foruym",b.className="text-input hidden svelte-foruym",b.value=e.confStr,M.className="view svelte-foruym",g.className="editor svelte-foruym",_.className="sidebarPanel-codeEditorContainer svelte-foruym",r.className="sidebarPanel svelte-foruym",n.className="editor-sidebarContainer editor_sidebarExpanded svelte-foruym",C.className="editor-viewerContainer editor_sidebarExpanded"},m(t,e){o(t,n,e),i(n,r),i(r,p),i(p,m);for(var a=0;a<W.length;a+=1)W[a].m(m,null);i(r,f),i(r,_),i(_,g),i(g,v),i(v,y),i(v,w),i(v,k),i(g,T),i(g,b),i(g,N),i(g,M),i(M,L),o(t,x,e),o(t,C,e),H._mount(C,null),S=!0},p(n,r){if(e=r,n.dropdownMenu){P=e.dropdownMenu;for(var i=0;i<P.length;i+=1){const r=z(e,P,i);W[i]?W[i].p(n,r):(W[i]=U(t,r),W[i].c(),W[i].m(m,null))}for(;i<W.length;i+=1)W[i].d(1);W.length=P.length}S&&!n.confStr||(b.value=e.confStr,d(L,e.confStr));var o={};n.permalink&&(o.permalink=e.permalink),!E.map&&n.map&&(o.map=e.map,E.map=void 0!==e.map),H._set(o),E={}},i(t,e){S||this.m(t,e)},o(t){S&&(H&&H._fragment.o(t),S=!1)},d(t){t&&a(n),s(W,t),u(y,"click",D),u(k,"click",O),t&&(a(x),a(C)),H.destroy()}}}(this,this._state),this.root._oncreate.push(()=>{(function(){}).call(this),this.fire("update",{changed:n({},this._state),current:this._state})}),t.target&&(this._fragment.c(),this._mount(t.target,t.anchor),m(this)),this._intro=!0}e(I.prototype,g),e(I.prototype,O);let G=(()=>{let t={};return location.search.substr(1).split("&").forEach(e=>{let n=e.split("=");t[n[0]]=n[1]}),t})();return new I({target:document.body,data:{urlParams:G,name:"world"}})}();
//# sourceMappingURL=bundle.js.map
