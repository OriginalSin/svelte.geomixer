<li class="line cmd:toggleIcons id:{nodeID}">
{#if properties}
	{#if line.type !== 'map'}
	<div class="borders "></div>
	<input class="expander expanderInput hidden" type="checkbox" checked={properties.expanded ? true : false} />
	<span class="expander pointer cmd:toggleFolder expanderCont {line.content.children ? '' : 'hidden'}"><svg role="img" class="svgIcon"><use xlink:href="#arrow-small-down" href="#arrow-small-down"></use></svg></span>
		{#if line.type === 'layer'}
			{#if properties.styles.length > 1}
	<span class="cont-overlays"><svg role="img" class="svgIcon"><use xlink:href="#overlays" href="#overlays"></use></svg></span>
			{/if}
	<span class="icons ">
 		<span class="pointer cmd:fitBounds cont-center"  title="Move map to this layer"><svg role="img" class="svgIcon"><use xlink:href="#center-on-click" href="#center-on-click"></use></svg></span>
			{#if properties.description}
		<span class="pointer cmd:showInfo cont-info" title="View description" on:click="showInfo(this, event)"><svg role="img" class="svgIcon"><use xlink:href="#info-circle-i" href="#info-circle-i"></use></svg></span>
			{/if}
	</span>
		{/if}
	{/if}
		{#if line.type !== 'map'}
	<span class="cont">
		{#if line.type === 'layer'}
		<input class="check visibility pointer cmd:toggleVisibility" type="checkbox" checked={layersTree && layersTree.visible[nodeID] ? true : false} />
		<span class="styleIcon gmx-style-legend">
		{#if styles.length && styles.length < 2 && styles[0].RenderStyle}
			<LegendIconCell item={styles[0]} type={properties.GeometryType} />
		{/if}
		</span>
		{/if}
		<label class="pointer title cmd:toggleVisibility" on:click="toggleVisibility(this, event)">{properties.title}</label>
		<div class="description collapse"></div>
		{#if line.type === 'layer'}
		<div class="legend">
			{#if styles.length && styles.length > 1 && styles[0].RenderStyle}
			{#each styles as it}
				<div class="gmx-style-legend">
					<span class="legendIconEye enabled pointer cmd:toggleStyle">
						<svg role="img" class="svgIcon on"><use xlink:href="#eye-on" href="#eye-on"></use></svg>
						<svg role="img" class="svgIcon off"><use xlink:href="#eye-off" href="#eye-off"></use></svg>
					</span>
					<LegendIconCell item={it} type={properties.GeometryType} />
					<span class="legendIconCell"><span class="styleName">{it.Name}</span></span>
				</div>
			{/each}
			{/if}
		</div>
		{/if}
	</span>
		{/if}
{/if}
{#if line.content.children}
	<ul class="group css-treeview id_{properties ? properties.name : 'root'}">
	{#each line.content.children || [] as child}
		<svelte:self line="{child}"  bind:layersTree />
	{/each}
	</ul>
{/if}
</li>
 
<script>
	import LegendIconCell from './LegendIconCell.html';
	export default {
		data() {
			return {
				line: null
			}
		},
		computed: {
			properties: ({ line }) => line.content.properties,
			nodeID: ({ properties }) => properties ? properties.name || properties.GroupID : 'root',
			styles: ({ properties }) => properties.gmxStyles ? properties.gmxStyles.styles : []
		},
		components: {
			LegendIconCell
		},
		methods: {
			toggleVisibility(target) {
				let {line} = this.get(),
					node = line.type === 'group' ? target.parentNode.parentNode.getElementsByClassName('expanderInput')[0] : target.parentNode.getElementsByClassName('cmd:toggleVisibility')[0];
				// console.log('toggleVisibility', node, line);
				if (node) {
					if (node.checked) {
						node.checked = false;
					} else {
						node.checked = true;
					}
				}
			},
			showInfo(target) {
				let node = target.parentNode.nextElementSibling.getElementsByClassName('description')[0];
				if (node) {
					if (node.classList.contains('collapse')) {
						let {line} = this.get();
						node.innerHTML = line.content.properties.description || '';
						node.classList.remove('collapse');
					} else {
						node.classList.add('collapse');
					}
				}
			}
		}
	}
</script>


<style>
.TreeView {
    overflow: scroll;
    height: calc(100vh - 30px);
    width: 360px;
    position: absolute;
}
ul {
	padding-inline-start: 12px;
}
li {
    list-style: none;
	line-height: 10px;
    text-overflow: ellipsis;
    white-space: nowrap;
	width: 98%;
    padding-right: 16px;
    overflow: hidden;	
}
li.line > .icons span.cont-center {
	visibility: hidden;
}
li.line:hover > .icons span.cont-center {
	visibility: visible;
}
li.line:hover > .cont label.title {
	font-weight: bold;
}

svg {
	pointer-events: none;
}

svg {
    height: 14px;
    width: 14px;
}
.expanderCont {
    margin-left: -20px;
}

.pointer {
    cursor: pointer;
}

input.expander:checked + span.expander svg {
    transform: rotate(-90Deg);
}

.legend {
	padding-left: 25px;
}
input.check.visibility ~ .legend {
    display: none;
}
input.check.visibility:checked ~ .legend {
    display: block;
}
.gmx-style-legend .legendIconCell.style {
    top: 0px;
    position: relative;
}
.gmx-style-legend .legendIconCell {
    width: 100%;
}
.legendIconEye.enabled > .on, .legendIconEye > .off {
    display: inline-block;
}
.legendIconEye > .on, .legendIconEye.enabled > .off {
    display: none;
}

.line input.expander:checked ~ ul {
    display: block;
}

.line input.expander ~ ul {
    display: none;
}
.collapse {
    display: none;
}

span.cont-overlays {
    position: absolute;
    left: 4px;
	padding-top: 4px;
}
span.icons {
	z-index: 1;
    right: 2px;
    position: absolute;
}
.hidden {
    visibility: hidden;
}

.pointer.title {
    position: relative;
    bottom: 4px;
}
.styleName {

    position: relative;
    bottom: 4px;

}
</style>
