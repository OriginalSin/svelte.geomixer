<div class="TreeView" on:click="chkEvent(event)">
	<LineNode line={rawTree} bind:layersTree />
</div>
 

<style>
</style>

<script>
	import LineNode from './LineNode.html';
	let regs = {
		cmd: /cmd:(\w+)/,
		id: /id:(\w+)/
	}
	export default {
		data() {
			return {
				config: {},
				layersTree: {},
				group: null,
				rawTree: null
			}
		},

		methods: {
			chkEvent(ev) {
				let target = ev.target,
					className = target.className,
					arr = regs.cmd.exec(className);

				if (arr && arr.length === 2) {
					let out = {
						cmd: arr[1],
						type: ev.type,
						originalEvent: ev
					};
					for(let i = 0; i < 5; i++) {
						if (target.classList.contains('line')) {
							arr = regs.id.exec(target.className);
							if (arr && arr.length === 2) {
								out.id = arr[1];
							}
							break;
						}
						target = target.parentNode;
					}
					if (out.id) {
						this.treeCommands(out);
						this.fire('command', out);
					}
				}
			},

			treeCommands(attr) {
				let {layersTree, rawTree} = this.get();
				// console.log('treeCommands', attr, layersTree, rawTree);

				if (attr.cmd === 'toggleFolder') {
					let expanded = layersTree.expanded || {},
						input = attr.originalEvent.target.previousElementSibling,
						id = attr.id;
					if (expanded[id]) {
						delete expanded[id];
						input.checked = false;
					} else {
						expanded[id] = true;
						input.checked = true;
					}
					this.set({layersTree: layersTree});
					return true;
				} else if (attr.cmd === 'showInfo') {
					let tt = rawTree;
					let input = attr.originalEvent.target,
						id = attr.id;
				}
				return false;
			},
		},
		components: {
			LineNode
		}
	}

</script>
